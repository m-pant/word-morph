# Техническое задание: Утилита поиска семантически близких слов с трансформациями

## 1. Общее описание

Веб-сервис для поиска семантически близких слов на основе векторных эмбеддингов с возможностью применения различных текстовых трансформаций к результатам.

## 2. Технологический стек

- **Язык программирования**: Python 3.9+
- **Библиотека эмбеддингов**: Navec (русскоязычные word embeddings)
- **Веб-фреймворк**: FastAPI
- **Контейнеризация**: Docker, Docker Compose
- **Формат ответа**: JSON

## 3. Функциональные требования

### 3.1. Архитектура и развертывание

- Приложение должно запускаться в Docker-контейнере
- Должен быть предоставлен `docker-compose.yml` файл для простого запуска
- Сервис должен быть доступен по HTTP на порту 8080 (настраиваемо через переменные окружения)

### 3.2. API интерфейс

#### 3.2.1. Метод запроса
- HTTP GET запрос на endpoint `/api/words`
- Все параметры передаются через query string

#### 3.2.2. Параметры запроса

| Параметр | Тип | Обязательный | Описание | Пример |
|----------|-----|--------------|----------|---------|
| `word` | string | Да | Исходное слово для поиска | `гроза` |
| `count` | integer | Нет | Количество возвращаемых слов (по умолчанию: 10) | `5` |
| `shuffle_letters` | boolean | Нет | Перестановка букв в словах (по умолчанию: false) | `true` |
| `skip_letters` | integer | Нет | Количество букв для пропуска (0 = не пропускать) | `1` |
| `show_skipped` | boolean | Нет | Показывать пропущенные буквы как `_` (по умолчанию: false) | `true` |
| `add_errors` | boolean | Нет | Добавлять случайные ошибки в слова (по умолчанию: false) | `true` |
| `letter_type` | string | Нет | Тип букв для трансформаций: `all`, `vowels`, `consonants` (по умолчанию: `all`) | `vowels` |
| `preserve_first` | boolean | Нет | Не трогать первую букву (по умолчанию: false) | `true` |
| `preserve_last` | boolean | Нет | Не трогать последнюю букву (по умолчанию: false) | `true` |

### 3.3. Основная функциональность

#### 3.3.1. Поиск семантически близких слов
- Использование векторных эмбеддингов из библиотеки Navec
- Вычисление косинусного сходства между векторами слов
- Возврат топ-N наиболее близких слов по семантике

**Пример**: запрос со словом `мебель` возвращает: `диван`, `стул`, `кресло`, `стол`, `шкаф`

#### 3.3.2. Режим без трансформаций (по умолчанию)
- Возврат слов без изменений
- Просто список семантически близких слов

**Пример**: 
- Вход: `гроза`
- Выход: `дождь`, `снег`, `туча`, `ливень`, `буря`

### 3.4. Трансформации слов

Все трансформации применяются к найденным семантически близким словам, а не к исходному запросу.

#### 3.4.1. Перестановка букв (`shuffle_letters=true`)
- Случайная перестановка букв в словах
- С учетом параметров `preserve_first`, `preserve_last`, `letter_type`

**Пример**:
- Вход: `гроза`
- Выход: `джодь`, `сенг`, `утча`

#### 3.4.2. Пропуск букв (`skip_letters=N`)
- Удаление N случайных букв из каждого слова
- Параметр `show_skipped=true` заменяет пропущенные буквы на `_`
- С учетом параметров `preserve_first`, `preserve_last`, `letter_type`

**Примеры**:
- `skip_letters=1, show_skipped=false`: `дждь`, `снг`, `туч`
- `skip_letters=1, show_skipped=true`: `д_ждь`, `сн_г`, `туч_`

#### 3.4.3. Добавление ошибок (`add_errors=true`)
- Замена случайных букв на похожие или случайные буквы
- С учетом параметров `preserve_first`, `preserve_last`, `letter_type`
- Количество ошибок: 1-2 на слово (в зависимости от длины)

**Пример**:
- Вход: `гроза`
- Выход: `диждь`, `сног`, `тучк`

### 3.5. Фильтры трансформаций

#### 3.5.1. Тип букв (`letter_type`)
- `all` (по умолчанию): трансформации применяются ко всем буквам
- `vowels`: только к гласным буквам (а, е, ё, и, о, у, ы, э, ю, я)
- `consonants`: только к согласным буквам

**Пример с `letter_type=vowels, shuffle_letters=true`**:
- `дождь` → `додж` (перемешаны только гласные)

#### 3.5.2. Сохранение первой/последней буквы
- `preserve_first=true`: первая буква остается на месте
- `preserve_last=true`: последняя буква остается на месте
- Можно использовать оба параметра одновременно

**Пример с `preserve_first=true, preserve_last=true, shuffle_letters=true`**:
- `дождь` → `дождь` или `дожьд` (перемешаны только средние буквы)

### 3.6. Формат ответа

#### 3.6.1. Успешный ответ (HTTP 200)

```json
{
  "status": "success",
  "query": {
    "word": "гроза",
    "count": 5,
    "transformations": {
      "shuffle_letters": false,
      "skip_letters": 1,
      "show_skipped": true,
      "add_errors": false,
      "letter_type": "all",
      "preserve_first": false,
      "preserve_last": false
    }
  },
  "results": [
    "д_ждь",
    "сн_г",
    "туч_",
    "лив_нь",
    "бур_"
  ]
}
```

#### 3.6.2. Ошибка - слово не найдено (HTTP 404)

```json
{
  "status": "error",
  "error": "word_not_found",
  "message": "Слово 'абвгдейка' не найдено в словаре эмбеддингов"
}
```

#### 3.6.3. Ошибка - невалидные параметры (HTTP 400)

```json
{
  "status": "error",
  "error": "invalid_parameters",
  "message": "Параметр 'count' должен быть положительным числом"
}
```

## 4. Нефункциональные требования

### 4.1. Производительность
- Время ответа на запрос: не более 500ms для запросов с `count <= 10`
- Поддержка до 100 одновременных запросов

### 4.2. Надежность
- Graceful обработка ошибок
- Логирование всех запросов и ошибок
- Health check endpoint `/health` для мониторинга

### 4.3. Масштабируемость
- Возможность запуска нескольких экземпляров контейнера
- Модель Navec загружается один раз при старте приложения

## 5. Структура проекта

```
.
├── docker-compose.yml
├── Dockerfile
├── requirements.txt
├── app/
│   ├── main.py              # Точка входа приложения
│   ├── embeddings.py        # Работа с Navec
│   ├── transformations.py   # Логика трансформаций
│   └── utils.py             # Вспомогательные функции
└── README.md
```

## 6. Примеры использования

### Пример 1: Базовый поиск
```
GET /api/words?word=мебель&count=3
```

Ответ:
```json
{
  "status": "success",
  "query": {"word": "мебель", "count": 3, "transformations": {...}},
  "results": ["диван", "стул", "кресло"]
}
```

### Пример 2: Перестановка букв
```
GET /api/words?word=гроза&count=3&shuffle_letters=true
```

### Пример 3: Пропуск букв с индикаторами
```
GET /api/words?word=гроза&count=3&skip_letters=1&show_skipped=true
```

### Пример 4: Ошибки только в согласных, сохраняя первую букву
```
GET /api/words?word=погода&count=5&add_errors=true&letter_type=consonants&preserve_first=true
```

### Пример 5: Комплексная трансформация
```
GET /api/words?word=природа&count=5&shuffle_letters=true&letter_type=vowels&preserve_first=true&preserve_last=true
```

## 7. Дополнительные требования

### 7.1. Docker Compose
- Должен автоматически скачивать модель Navec при первом запуске (или включить в образ)
- Должен монтировать volume для кэширования модели
- Переменные окружения для настройки порта и других параметров

### 7.2. Документация
- README.md с инструкциями по запуску
- Примеры всех типов запросов
- Описание всех параметров API

### 7.3. Обработка русского языка
- Поддержка русских букв в разных регистрах
- Корректная работа с буквой "ё"

## 8. Ограничения и допущения

- Работа только с русскоязычными словами
- Словарь ограничен размером модели Navec
- Трансформации применяются случайным образом (детерминированность не гарантируется)
- Максимальное значение `count`: 100
- Минимальная длина слова для трансформаций: 3 буквы
